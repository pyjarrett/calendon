# Purpose

A common tool across platform to do builds, run tests, run demos and control
the Knell environment.

## Modes

The helper tool may be run from a shell like many tools which have subcommands
and related arguments and options:

`py/crank.py command [arg1] [args2] ...`

Crank may also be run in an interactive mode, by simply not providing a
command to run.  This allows team members to maintain their build and run
environment between commands.

## Crank arguments

`--knell-home DIR` - Root directory of the Knell project.  This will override
the environment variable `KNELL_HOME` if used.

`--config FILE` - Specify a different configuration file to use rather than
searching the current directory and user's home directory.

## Environment Variables

`KNELL_HOME` - Specifies the root folder of the project.  This is used to
locate Knell if Crank is run from a non-standard directory.

## General Purpose Arguments

`--dry-run` - Show what commands would have been run.

`--verbose` - Log more details than normal.

## Build and testing

`clean` - Wipes a build directory.  When using `ccache`, the penalty on the
next build is minimal.

`gen [--force]` - Generate a build target for a given configuration.  In
general, builds should be generated very few times for every build which
occurs. With `--force`, will delete any preexisting build directory.

`build` - Build a configuration with a known compiler and configuration.

`check [--iterate]` - Runs regression tests, which include both unit and
integration tests.  `--iterate` will only cause previously failed tests to run
which improves programmer iteration cycle when using test-driven development
(TDD).

### Arguments

`--build-dir DIR` - A directory to create or use, which will contain artifacts
created as part of the build process.

`--build-config BUILD_CONFIG` - A build configuration which changes applied
compiler and linker flags, and may change preprocessor defines.

`--compiler COMPILER_ALIAS` - Use a registered program as the compiler.

## Running demos

Demos live in `src/demos`, and provide example programs to run and learn from.
"Demo" isn't the greatest term for these, since they might be tech demos or 
complete games. 

`demo` - List available demos.
`run [DEMO_NAME]` - Run the default demo.

### Arguments

`--ticks TICKS` - Specifies the number of game ticks to run the demo.

`--runtime SECONDS` - Only run the demo for a specific amount of time.

`--headless` - Runs the demo without the UI starting up.

`--game GAME` - Specify the game (or demo) to load at driver startup.

`--asset-dir DIR` - Sets the directory from which to load assets.

`--from-replay REPLAY_FILE` - Replays inputs as specified by a replay file.

`--to-replay REPLAY_FILE` - Generates a replay file of all inputs, ticks,
and frame draws.
 
## Control the Environment

`env` - Prints the current Crank configuration, environment variables (except
PATH), and the list of registered programs.  PATH is split appropriately by OS
delimiter and reported on separate lines.

`register ALIAS PATH [--force]` - Register a program as a "known" program to
run.

`default NAME VALUE` - Most of the build and run flags can be set as defaults
within the `.crank` config file.

    `default build-dir BUILD_DIR`
    `default build-config BUILD_CONFIG`
    `default compiler COMPILER_ALIAS`
    `default demo DEMO_NAME`

## API Version management

`syms` - (Optional) Prints symbols defined within the program.

`semver status` - Report if the current API would be a major, minor, or patch
version change.

`semver diff [SEMVER]` Report API differences between this and another
semantic version of the API.

`semver tag` - Creates a new semantic version and creates an associated git tag
to identify that release as `vMAJOR.MINOR.PATH`.

## Program analysis

`coverage` - (Optional) Generate coverage information such as generated by `gcc`.

- miscellaneous operations
    - `lint` - Run linting for the engine code.
    - `pycheck [--incremental]` - Run python lint and testing.
    - `prepush` - Run presubmit checks.    

## Command history and automation

`history` - Prints a history of recent commands, showing the history number of
each to be used with the `redo` command.

`redo HISTORY_NUM` - Re-run a previous command by specifying its history number.

`source FILE` - Run commands from a given file as if they had been typed in
line by line.

`save [FILE]` - Saves the current configuration.  If no file is specified, it
will save to the configuration file originally loaded.

`load [FILE]` - Loads a configuration from file.  This also sets the current
configuration file which will be saved.

## Programs expected in the environment

### General purpose

These programs are **required** for Crank to function properly.

- `cmake`
- `python`
- `git`

### Python scripts

- `mypy`
- `pycodelint`
- `pydoclint`
- `bandit`

### Optional

- `<various compilers>`
- `gcc`
- `clang`
- `cppcheck`
- `clang-tidy`
- `ccache`
